# Конфигурационное управление
Домашнее задание №2
## Вариант 24
### Задание 2
Разработать инструмент командной строки для визуализации графа зависимостей, включая транзитивные зависимости.

Сторонние средства для получения зависимостей использовать нельзя.

Зависимости определяются для git-репозитория. Для описания графа зависимостей используется представление PlantUML. 

Визуализатор долженвыводить результат в виде сообщения об успешном выполнении и сохранять граф в файле формата png.

Построить граф зависимостей для коммитов, в узлах которого находятся списки файлов и папок.

Конфигурационный файл имеет формат ini и содержит:

• Путь к программе для визуализации графов.

• Путь к анализируемому репозиторию.

• Путь к файлу с изображением графа зависимостей.

Все функции визуализатора зависимостей должны быть покрыты тестами

### Описание

Этот код предназначен для визуализации графа зависимостей коммитов в Git-репозитории. 

Он использует конфигурационный файл для указания путей к репозиторию, визуализатору PlantUML и выходному изображению. 

С помощью PlantUML и информации о коммитах и их родителях, код генерирует граф зависимостей в формате изображения.

## Установка

1. Убедитесь, что у вас установлен **Git**.
   
2. Установите **Java** и **PlantUML**, так как они требуются для генерации графа.

## Конфигурация

Создайте файл `config.ini` в корневой директории проекта и укажите следующие параметры:

```ini
[settings]
visualizer_path = путь_к_plantuml.jar
repository_path = путь_к_репозиторию
output_image_path = путь_к_выходному_изображению.png
```

## Классы и методы

**`DependencyVisualizer`**

Класс DependencyVisualizer предназначен для загрузки конфигурации, получения информации о коммитах, генерации файла PlantUML и визуализации графа зависимостей.

__init__(self, config_file)

Конструктор класса. Инициализирует объект DependencyVisualizer с конфигурационным файлом config_file. 

Загружает конфигурацию и устанавливает пути к визуализатору, репозиторию и выходному файлу.

Аргументы:

config_file: строка, содержащая путь к конфигурационному файлу.



**`load_config(self, config_file)`**

Загружает конфигурацию из файла config_file с помощью configparser. Возвращает объект конфигурации с параметрами из секции settings.

Аргументы:

config_file: строка, содержащая путь к конфигурационному файлу.

Возвращаемое значение:

Объект конфигурации с параметрами.

**`get_commits_with_parents(self)`**

Получает список коммитов и их родительских коммитов из Git-репозитория, используя команду git log. Метод изменяет текущую директорию на repository_path и считывает вывод команды git log --pretty=format:"%H %P", где:

%H — хеш коммита,
%P — хеш родительских коммитов.

Возвращает список кортежей (commit, parents).

Возвращаемое значение:

Список кортежей, где каждый кортеж содержит хеш коммита и список родительских коммитов.

**`save_puml_file(self, puml_content, puml_file)

Сохраняет содержимое puml_content в файл puml_file.

Аргументы:

puml_content: строка с кодом PlantUML.

puml_file: путь к файлу, в который сохраняется содержимое.


**`visualize_graph(self)`**

Основной метод для создания графа. В этом методе:

Получаются данные о коммитах с помощью get_commits_with_parents.

Генерируется контент PlantUML для графа зависимостей.

Сохраняется файл PlantUML.

Визуализируется граф с использованием PlantUML, и итоговое изображение сохраняется в output_image_path.

**`get_files_changed(self, commit)`**

Эта функция используется для получения спискафайлов, измененных в конкретном коммите.

Она выполняет команду Git git diff-tree --no-commit-id --name-only -r {commit},

которая возвращает имена файлов, измененных в данном коммите.

Аргументы:

commit: строка, содержащая хеш коммита, для которого нужно получить список измененных файлов.

Возвращаемое значение:

Список путей к файлам, которые были изменены в данном коммите. 

**`shorten_commit(self, commit_hash)`**

Эта функция сокращает хеш коммита до первых 7 символов, что удобно для отображения и уменьшает визуальный "шум" в графе. Git часто использует первые 7 символов полного хеша коммита, чтобы уникально его идентифицировать.

Аргументы:

commit_hash: строка, представляющая полный хеш коммита.

Возвращаемое значение:

Строка, содержащая первые 7 символов от переданного хеша коммита.

**`generate_puml_content(self, commits_with_parents)`**

Эта функция генерирует содержимое файла PlantUML (PUML) для визуализации графа зависимостей коммитов, учитывая слияния и ветвления. Она создает классы для каждого коммита, добавляя измененные файлы в качестве атрибутов, а затем добавляет зависимости между коммитами и их родителями.

Аргументы:

commits_with_parents: список кортежей, где каждый кортеж содержит хеш коммита и список родительских коммитов.

Возвращаемое значение:

Строка с кодом PUML, представляющим граф зависимостей.

Работа функции:

Инициализирует puml_lines со строкой @startuml, указывающей начало диаграммы PlantUML.

Для каждого коммита:

Создает сокращенный хеш с помощью shorten_commit.

Получает список измененных файлов с помощью get_files_changed.

Добавляет каждый файл в класс, представляющий коммит, с помощью \\n для форматирования вывода.

Для каждого родительского коммита создает связь между коммитом и его родителем.

Завершает диаграмму строкой @enduml.

![image](https://github.com/user-attachments/assets/a15e6617-c9aa-40de-9263-2204d88dbd9a)

**`run(self)`**
Запускает процесс визуализации графа зависимостей. Вызывает visualize_graph и выводит сообщение о успешном сохранении изображения.

Основной блок if __name__ == '__main__':
Создает экземпляр класса DependencyVisualizer и запускает метод run(), передавая конфигурационный файл config.ini.
![image](https://github.com/user-attachments/assets/5ffa54b2-f683-4ee9-95bf-0540ba08588f)

## Результаты тестирования

Ожидаемый результат:

![image](https://github.com/user-attachments/assets/c5a60158-3c97-4b20-ba83-e27b253b880c)

Итоговый:

![image](https://github.com/user-attachments/assets/5abb9eac-a54b-402f-b2f4-1813b99b53fc)

Результат для данного репозитория:

![image](https://github.com/user-attachments/assets/4607e204-0f96-4dfd-9341-4d79d1609245)

Результат для репозитория из ДЗ №1

![dependency_graph](https://github.com/user-attachments/assets/87a34b59-4f92-4e03-a672-796bae2ef05f)


